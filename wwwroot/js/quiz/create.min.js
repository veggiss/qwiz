$(document).ready(function(){function r(n){let t=new FormData;return t.set("image",n),new Promise(function(n,i){axios.post("/api/uploadImage",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){n(t.data)}).catch(function(n){i(n)})})}function e(){$(".collapseQuizForm").each(function(n){this.innerHTML="Question "+(n+1)})}function o(){if(t()>1&&$("#quizForm")[0].checkValidity()){let t="/api/create",n={topic:$("#quizTitle").val(),category:$("#quizCategory").val(),description:$("#quizDescription").val(),imagePath:$("#quizImgPrev").attr("src"),difficulty:$("#quizDifficulty").children("option:selected").val(),questions:[]};$(".quizForm").each(function(){let i=f([$(this).find(".questionType")[0].selectedIndex]),t=$(this).find(".alternative"),u=i==="multiple_choice"?JSON.stringify([t[0].value,t[1].value,t[2].value,t[3].value]):null,r=$(this).find(".correctAlternative").children("option:selected")[0].value,e=i==="true_false"?r:$(this).find(`[name=${r}]`)[0].value,o={correctAnswer:e,correctAlternative:r,questionText:$(this).find(".questionText")[0].value,questionType:i,imagePath:$(this).find(".questionImgPrev").attr("src"),alternatives:u,difficulty:$(this).find(".questionDifficulty").children("option:selected").val().toLowerCase()};n.questions.push(o)});i()&&(n.id=model.id,n.ownerId=model.ownerId,t="/api/update");axios.post(t,JSON.stringify(n),{headers:{"Content-Type":"application/json"}}).then(function(n){n.status===200&&(window.location.href="/Profile");console.log("testingsss",n)}).catch(function(n){console.log(n.error);console.log(n);console.log("lololol")})}else $(".alert").show().delay(2e3).fadeOut()}function s(){if(i()){let n=model;$("#btnCreateQuiz").text("Update Quiz");$("#quizTitle").val(n.topic);$("#quizCategory").val(n.category);$("#quizDescription").val(n.description);$("#quizImgPrev").attr("src",n.imagePath);n.questions.forEach(n=>{let t=$(u()),r=$(t).find(".alternative");$(t).find(".questionText").val(n.questionText);$(t).find(".questionDifficulty").val(n.difficulty);$(t).find(".questionImgPrev").attr("src",n.imagePath);let i=JSON.parse(n.alternatives);i!=null&&i.forEach((n,t)=>{$(r[t]).val(n)});$("#quizField").append(t);$(t).find(".questionType").val(n.questionType);$(t).find(".questionType").trigger("change");$(t).find(".correctAlternative").val(n.correctAlternative)});$("#deleteDiv").show();$("#btnDeleteQuiz").click(function(){axios.delete("/api/delete?id="+n.id).then(function(n){n.status===200&&(window.location.href="/Profile")})})}}function u(){return`
                <div class="quizForm"><hr>
                    <button type="button" class="btn btn-light collapseQuizForm" style="width:100%">Question ${t()}</button>
                    <div class="collapse">
                        <button type="button" class="close removeQuizForm" aria-label="Close">
                            <span aria-hidden="true" title="Remove Question" style="color:#dc3545;">&times;</span>
                        </button>
                        <label>Question Text</label>
                        <textarea class="border rounded bg-white questionText" maxlength="128" required style="margin-bottom: 15px; padding: 5px; font-size: 30px; width: 100%; text-align: center;"></textarea>
                        
                        <label>Question Image</label>
                        <input type="file" class="btn btn-primary questionImg" style="margin: 5px; width: 98%" value="Add image"/>
                        <img style="display:block; margin:auto;" class="questionImgPrev" width="500"/>
                        
                        <div class="form-group">
                            <label>Question Difficulty</label>
                            <select class="form-control questionDifficulty">
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Question Type</label>
                            <select class="form-control questionType">
                                <option value="multiple_choice">Multiple Choice</option>
                                <option value="true_false">True or False</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Correct Answer</label>
                            <select class="form-control correctAlternative">
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                            </select>
                        </div>
                        
                        <div class="form-row alternatives">
                            <div class="form-group col-md-6">
                                <input type="text" name="A" class="form-control text-center alternative" placeholder="Alternative A" required>
                            </div>
                            <div class="form-group col-md-6">
                                <input type="text" name="B" class="form-control text-center alternative" placeholder="Alternative B" required>
                            </div>
                            <div class="form-group col-md-6">
                                <input type="text" name="C" class="form-control text-center alternative" placeholder="Alternative C" required>
                            </div>
                            <div class="form-group col-md-6">
                                <input type="text" name="D" class="form-control text-center alternative" placeholder="Alternative D" required>
                            </div>
                        </div>
                    </div>
                </div>`}let f=n=>["multiple_choice","true_false"][n],t=()=>$(".quizForm").length+1,n=n=>$(n).closest(".quizForm"),i=()=>model!==null;$("#btnAddQuizForm").click(function(){$("#quizField").append(u())});$("#btnCreateQuiz").click(function(){o()});$(".alert .close").click(function(){$(".alert").hide()});$(document).on("change",".questionType",function(t){let i=n(this).find(".correctAlternative"),r=n(this).find(".alternatives"),u=t.currentTarget.selectedIndex;u===0?(r.show(),i.empty(),r.find("input").each(function(){$(this).attr("required",!0)}),["A","B","C","D"].forEach(n=>{i.append($("<option><\/option>").text(n))})):(r.hide(),i.empty(),r.find("input").each(function(){$(this).attr("required",!1)}),[{text:"True",value:!0},{text:"False",value:!1}].forEach(n=>{i.append($("<option><\/option>").attr("value",n.value).text(n.text))}))});$(document).on("click","button.removeQuizForm",function(){n(this).remove();e()});$(document).on("click","button.collapseQuizForm",function(){n(this).find(".collapse").slideToggle("slow","swing")});$(document).on("change","input.questionImg",function(){r(this.files[0]).then(t=>{n(this).find(".questionImgPrev").attr("src",t)}).catch(n=>console.log(n))});$("#quizImg").change(function(){r(this.files[0]).then(n=>{$("#quizImgPrev").attr("src",n)}).catch(n=>console.log(n))});s()});