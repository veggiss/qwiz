$(document).ready(function(){new Vue({el:"#quizForm",data:{isEdit:model!==null,question:{questionType:"multiple_choice",questionText:"",correctAnswer:"",correctAlternative:"A",difficulty:"easy",imagePath:"",alternatives:["","","",""]},questions:[]},mounted:function(){$("#btnAddQuestion").click(()=>this.addQuestion());$("#btnCreateQuiz").click(()=>this.submitQuiz());$("#quizImg").change(n=>this.changeQuizImg(n));$("#btnDeleteQuiz").click(()=>this.deleteQuiz());$(".alert .close").click(()=>$(".alert").hide());this.isEdit&&($("#quizCategory option").filter(function(){return $(this).text()===model.category}).prop("selected",!0),$("#quizTitle").val(model.topic),$("#quizDifficulty").val(model.difficulty),$("#quizImgPrev").attr("src",model.imagePath),$("#quizDescription").val(model.description),model.questions.forEach((n,t)=>{delete n.id,n.questionType==="multiple_choice"&&(n.alternatives=JSON.parse(n.alternatives)),this.$set(this.questions,t,n)}))},methods:{onCollapse:function(n){$(n.target).next().slideToggle("slow","swing")},addQuestion:function(){this.questions.push(this.question)},submitQuiz:function(){if(this.questions.length>0&&$("#quizForm")[0].checkValidity()){let n="/api/quiz/create",t={topic:$("#quizTitle").val(),difficulty:$("#quizDifficulty").find(":selected").val(),category:$("#quizCategory").find(":selected").val(),imagePath:$("#quizImgPrev").attr("src"),description:$("#quizDescription").val(),questions:this.questionsToJson()};this.isEdit&&(t.id=model.id,n="/api/quiz/update");axios.post(n,JSON.stringify(t),global.header).then(function(n){global.debug&&util.logResponse(n);n.status===200&&(window.location.href="/user")}).catch(n=>util.logResponse(n.response))}else $(".alert").show().delay(2e3).fadeOut()},onChange:function(n,t,i){let r=$.extend(!0,{},this.questions[t]);switch(n){case"text":r.questionText=i.target.value;break;case"difficulty":r.difficulty=i.target.value;break;case"type":let n=$(i.target).find(":selected").val();r.questionType=n;n==="multiple_choice"?r.correctAlternative="A":n==="true_false"&&(r.correctAlternative="T");break;case"answer":r.correctAlternative=i.target.value;break;case"image":util.uploadImage(i.target.files[0]).then(n=>r.imagePath=n).catch(n=>util.logResponse(n.response));break;case"alternative":let t=parseInt($(i.target).attr("index"));r.alternatives[t]=i.target.value}this.$set(this.questions,t,r)},changeQuizImg:function(n){util.uploadImage(n.target.files[0]).then(n=>$("#quizImgPrev").attr("src",n)).catch(n=>util.logResponse(n.response))},questionsToJson:function(){let n=[];return this.questions.forEach(t=>{let i=$.extend(!0,{},t);switch(i.correctAlternative){case"A":i.correctAnswer=i.alternatives[0];break;case"B":i.correctAnswer=i.alternatives[1];break;case"C":i.correctAnswer=i.alternatives[2];break;case"D":i.correctAnswer=i.alternatives[3];break;case"T":i.correctAnswer="True";break;case"F":i.correctAnswer="False"}i.alternatives=i.questionType==="multiple_choice"?JSON.stringify(i.alternatives):null;n.push(i)}),n},deleteQuiz:function(){this.isEdit&&global.isAuthenticated&&axios.delete("/api/quiz/delete/"+model.id,global.header).then(function(n){global.debug&&util.logResponse(n);n.status===200&&(window.location.href="/quiz")}).catch(n=>util.logResponse(n.response))}}})});