$(document).ready(function(){new Vue({el:"#quizField",data:{isEdit:model!==null,question:{questionType:"multiple_choice",questionText:"",correctAnswer:"",correctAlternative:"A",difficulty:"easy",imagePath:"",alternatives:["","","",""]},questions:[]},mounted:function(){$("#btnAddQuestion").click(()=>this.addQuestion());$("#btnCreateQuiz").click(()=>this.submitQuiz());$("#quizImg").change(n=>this.changeQuizImg(n));$(".alert .close").click(()=>$(".alert").hide())},methods:{onCollapse:function(n){$(n.target).next().slideToggle("slow","swing")},addQuestion:function(){this.questions.push(this.question)},submitQuiz:function(){if(this.questions.length>0&&$("#quizForm")[0].checkValidity()){let t="/api/quiz/create",n={topic:$("#quizTitle").val(),difficulty:$("#quizDifficulty").find(":selected").val(),category:$("#quizCategory").find(":selected").val(),imagePath:$("#quizImgPrev").attr("src"),description:$("#quizDescription").val(),questions:this.questionsToJson()};this.isEdit&&(n.id=model.id,n.ownerId=model.ownerId,t="/api/quiz/update");axios.post(t,JSON.stringify(n),{headers:{"Content-Type":"application/json"}}).then(function(n){global.debug&&util.logResponse(n);n.status===200&&(window.location.href="/Profile")}).catch(function(n){global.debug&&util.logResponse(n)})}else $(".alert").show().delay(2e3).fadeOut()},onChange:function(n,t,i){let r=$.extend(!0,{},this.questions[t]);switch(n){case"text":r.questionText=i.target.value;break;case"difficulty":r.difficulty=i.target.value;break;case"type":let n=$(i.target).find(":selected").val();r.questionType=n;n==="multiple_choice"?r.correctAlternative="A":n==="true_false"&&(r.correctAlternative="T");break;case"answer":r.correctAlternative=i.target.value;break;case"image":this.uploadImage(i.target.files[0]).then(n=>r.imagePath=n).catch(n=>{n.response.status===400&&util.openModal(n.response.data)});break;case"alternative":let t=parseInt($(i.target).attr("index"));r.alternatives[t]=i.target.value}this.$set(this.questions,t,r)},changeQuizImg:function(n){this.uploadImage(n.target.files[0]).then(n=>$("#quizImgPrev").attr("src",n)).catch(n=>{util.logResponse(n)})},uploadImage:function(n){let t=new FormData;return t.set("image",n),new Promise(function(n,i){axios.post("/api/user/uploadImage",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){global.debug&&util.logResponse(t);n(t.data)}).catch(function(n){i(n)})})},questionsToJson:function(){let n=[];return this.questions.forEach(t=>{let i=$.extend(!0,{},t);switch(i.correctAlternative){case"A":i.correctAnswer=i.alternatives[0];break;case"B":i.correctAnswer=i.alternatives[1];break;case"C":i.correctAnswer=i.alternatives[2];break;case"D":i.correctAnswer=i.alternatives[3];break;case"T":i.correctAnswer="True";break;case"F":i.correctAnswer="False"}i.alternatives=i.questionType==="multiple_choice"?JSON.stringify(i.alternatives):null;n.push(i)}),n}}})});