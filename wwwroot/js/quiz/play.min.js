$(document).ready(()=>{new Vue({el:"#app",data:{getBars:()=>$("#progressBars").children(),isAuthenticated:global.isAuthenticated,lastQuestion:!1,answered:!1,state:"intro",question:null,quiz:model,xpGained:0,xpGainedUnmodified:0,timer:0,page:0},methods:{onNextQuestion:function(){this.page<this.quiz.questions.length-1&&($("#question").find("button").removeClass("alert-danger bg-success"),this.answered=!1,this.page++,this.updateQuestion(),this.startTimer())},onAnswerQuestion:function(n){if(!this.answered){let t=this;axios.put(util.apiUrl("/api/question/answer",{quizId:this.quiz.id,questionId:this.question.id,guess:n.target.innerHTML,guessAlternative:n.target.name})).then(function(i){global.debug&&util.logResponse(i);let r=i.data.correctAlternative,f=n.target.name!==r,e=i.data.bonus,o=i.data.xpGained,u=t.getBars();t.answered=!0;t.stopTimer();$("#nextBtnCollapse").collapse("show");$("#question").find(`button[name='${r}']`).addClass("bg-success");f?($(n.target).addClass("alert-danger"),$(u[t.page]).addClass("bg-danger")):($(u[t.page]).addClass("bg-success"),t.addXpPoints(o+e))}).catch(n=>util.logResponse(n))}},updateQuestion:function(){this.question=this.quiz.questions[this.page];this.question.alternatives=this.question.alternatives==null?null:JSON.parse(this.question.alternatives);this.quiz.questions.length-1<=this.page&&(this.lastQuestion=!0)},onNextState:function(n){this.state=n;n==="question"?this.startTimer():n==="summary"&&(window.location.href="/Quiz/Summary/"+this.quiz.id)},startTimer:function(){$("#progressTimer").css("width","100%");$("#nextBtnCollapse").collapse("hide");global.isAuthenticated&&axios.put("/api/question/startTimer");this.stopTimer();this.timer=15;let n=0,t=this;this.counter=setInterval(function(){if(n++,n<=15){t.timer--;let i=(15-n)/15*100;$("#progressTimer").css("width",i+"%")}else t.stopTimer()},1e3)},stopTimer:function(){this.counter!==null&&clearInterval(this.counter)},addXpPoints:function(n){let t=this;this.xpGainedUnmodified+=n;$({count:t.xpGained}).animate({count:t.xpGainedUnmodified+1},{duration:2e3,easing:"swing",step:function(){t.xpGained=Math.floor(this.count)}})}},created:function(){this.updateQuestion()}})});